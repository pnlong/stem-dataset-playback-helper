# Original Idea

We are going to create a website today. This website is part of a broader project to record a stem-separated jazz improvisation dataset over the Real Book. This website will aid the musicians creating the dataset by providing a click track and playback of previously-recorded stems for each song. Let me define the flow of the app. My plan is to deploy this site with GitHub pages, and I'm aware it will need to store some stuff for persistence, but I'd like to avoid keeping any fancy databases and keeping things to GitHub pages.

When a user first opens the website, they are presented with a Welcome screen, that explains what the website is for. There is a single button that says Continue. Users will click Continue.

They are sent to a new page that asks them to upload a CSV file with columns song_id, title, bpm. This is a table that basically maps a bunch of song_id's to pre-decided BPMs, which are crucial for click tracks. Each song_id must have an associated non-Null BPM. title is optional, but if provided, should list the title of each song associated with song_id (individual items in the title column can be NA as well). The upload page explains what is expected of this CSV. After they upload, they confirm the upload, and they can click Next to go to the next page. This CSV will be remembered once entered.

On the next page, users are asked to enter the stems. Order matters. They will add instrument names to a listview. They can add as many instrument names as they like, but as they add them, the listview grows, and there are indexes to the left of the instrument names that have been added to show the clear fact that there is ordering to this. Explain on the bottom the expected recording process, where you record the first instrument first for every song, then the next instrument records using the recording of the first and click track, then the third instrument records using the recording of the first two and click track, and so on all the way until the final instrument. This recording process should be made clear on this page and the original welcome page (but will also be described in paper too), so users know that the order they enter the instruments matters. Once they are done, they can confirm their instrumentation, and can click Next to go to the next page.

On the next page is the main page. This is a list view ordered by song_id (assumed to be numbers), and each song_id is shown as a little box with the song id, title if available, and bpm. There is options at the top to search the listview, which allows the user to search and filter the listview by song_id. There is a option at the top to reset everything, which means resetting the original CSV and instrumentation less, which would cause all progress to be lost, but that is an option. Anyways, as I describe later, there will be a way to add completed stems, and we will track what stems have been added, and there is a progress bar on this homepage that shows how far along we are in completion as a percentage in number of stems. But anyways, this is how you access different songs to get playback for. The detailview for each song will be another page that is accessible when each song box in the list view is clicked on. I describe the detail view below.

The detail view is the main function of the website, which helps the musicians record their parts. When first opened, this page will display the following. A title which is formatted as f"{song_id}: {title}" if title is not None else f"{song_id}", followed with subtitle f"BPM: {bpm}". The same information was displayed in the card in the list view on the homepage. Below that are some toggleable options. First, there is a toggle for the click track. Next there is a toggle for count in. Next, there is a list of available instrument stems (the names of the instruments in the group for which stems are available, will describe how to add stems later). This is a list, and for each instrument name, there is a slider for 0% to 100% which represents how loud on a scale of muted to the original loudness level of that stem that stem should be in the playback. There is also a mute toggle (where mute is equivalent to 0% on the slider, and if mute is toggled on, the slider should sync and be set to mute, and if the slider moves while mute is toggled on, then mute gets toggled off automatically). Then below that is a play button then when pressed will play the mix according to the set parameters above. This will show a waveform amplitude of the mix (the mix includes the stems mixed with the velocity levels as well as the click track if specified and count in if specified, which counts in four beats before the mix actually starts at the given BPM, the click track is at the given BPM of course). The only action I can do on the waveform is start and stop it, there should also be a reset button to restart the mix from the start. Finally, below the playback region is a button that says "Edit Stems". This will bring up a view that broadly allows us to do two things: add new stems that aren't yet available for this song_id, or edit previously added stems that are already available for this song_id. once "Edit Stems" is pressed, a little modal will popup with the list view of all instruments for the ensemble (not just the ones with available stems). The user selects one of these, and based on whether there are stems available for that instrument for this song versus not, it goes to the edit screen versus add new screen (which are mostly the same). Also note that when an instrument gets a stem added, the progress bar on the main home page increments (the progress bar increments over X elements, where X = # of songs * # of instruments. Anyways, if adding a new stem, this changes what is being shown in the modal. At the top is input for a link to a WAV file stored somewhere via an online link (i.e. in google drive). It must be a WAV file, so that the website can download it for the mix, but doesn't have to store it persistently since it is already hosted somewhere. The WAV file gets loaded in after it gets entered and some button is pressed to upload it. Then, once uploaded, we can play back this uploaded WAV file (a stem), so this means there is some playback interface (play/pause button and reset button). When played back, the WAV file is played with the click track over it at the song's BPM, where the click track starts with the WAV file. Then below the playback is an option to adjust the offset (in seconds) of the WAV file with a slider. The min/max values of the slider are set to -5 and 5 by default but there is some input somewhere that allows them to be adjusted. There is also a simple text entry for the offset (in seconds) if the user doesn't want to use a slider. The starting offset is 0. negative offset (so an offset of -X where X is a positive number) means zero padding the front of the WAV with X seconds of silence. positive offset means starting the WAV X seconds in. If the offset is changed, any current playback is automatically paused and reset. But the offset is reflected in the playback, and the clicktrack still gets placed over starting from the start of the playback. This will allow users to listen back to the stem and line it up with the click track. At some point, the user will align their stem with some offset (there should be a recommendation that users should line their stem up such that the start of a song [excluding the pickup] starts on the lowest possible bar number while still starting on the first beat of the bar). Anyways, after adjusting the offset and finding a good one, the user presses "Save", which closes the "Edit Stems" modal. The online address to the WAV and determined offset get saved somewhere (perhaps in a CSV that I can easily access/download later, since the offset values will be useful down the line as well when I mix everything). If a user is editing an already-available stem, a similar page shows up, but the relevant fields are already filled in -- the offset is already set (but can be changed), the link to the WAV is already set (though we can change this link to change the stem out, though reuploading which reset the offset). In this case where the saved offset is outside the default slider bounds, update the slider bounds so that the offset fits in (e.g., since default slider bounds are [-5, 5], if the offset is 7, make the bounds [-5, 7]).

Please develop an implementation plan for the website I've described in the same directory as this file called implementation_plan.md. This is in ./scratchpaper. Plan to make the website in ./src. I want to use an HTML/CSS/JavaScript stack if possible. Please ask clarification questions as needed.