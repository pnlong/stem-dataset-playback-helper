<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Upload Songs - Stem Dataset Helper</title>
  <link rel="stylesheet" href="css/styles.css">
  <style>
    .songs-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    .songs-table th,
    .songs-table td {
      padding: 10px;
      border: 1px solid var(--border);
      text-align: left;
    }
    .songs-table th {
      background-color: var(--card-background);
      font-weight: 600;
    }
    .songs-table input[type="text"],
    .songs-table input[type="number"] {
      width: 100%;
      margin: 0;
      padding: 8px;
    }
    .songs-table tr:hover {
      background-color: var(--background);
    }
    .delete-row-btn {
      background-color: #dc3545;
      color: white;
      border: 1px solid #dc3545;
      padding: 5px 10px;
      cursor: pointer;
      border-radius: 4px;
      font-size: 0.9rem;
    }
    .delete-row-btn:hover {
      background-color: #c82333;
      border-color: #c82333;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Add Songs</h1>

    <div class="alert alert-info">
      <strong>Instructions:</strong>
      <ul style="margin-top: 10px; padding-left: 20px; margin-bottom: 0;">
        <li><strong>Title</strong> is required for each song</li>
        <li><strong>BPM</strong> and <strong>Time Signature</strong> are pre-filled with defaults (120 and 4/4) - edit as needed</li>
        <li><strong>Song IDs</strong> are automatically assigned (0, 1, 2...) unless you enable manual assignment</li>
      </ul>
    </div>

    <!-- Toggle for manual Song ID assignment -->
    <div class="card mt-3">
      <div class="toggle-container">
        <label>
          <div class="toggle">
            <input type="checkbox" id="manualSongIdToggle">
            <span class="toggle-slider"></span>
          </div>
        </label>
        <span>Manually assign Song IDs</span>
      </div>
      <p class="text-secondary" style="font-size: 0.9rem; margin-top: 10px; margin-bottom: 0;">
        When enabled, you can specify custom Song IDs for each song. When disabled, Song IDs are automatically assigned starting from 0.
      </p>
    </div>

    <!-- Manual Entry Table -->
    <div class="card mt-3">
      <h3>Song List</h3>
      <div style="overflow-x: auto;">
        <table class="songs-table" id="songsTable">
          <thead>
            <tr id="tableHeader">
              <th class="song-id-column hidden">Song ID</th>
              <th>Title *</th>
              <th>BPM</th>
              <th>Time Signature (e.g., 4/4)</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="songsTableBody">
            <!-- Rows will be added dynamically -->
          </tbody>
        </table>
      </div>
      <button class="btn btn-primary mt-3" id="addRowBtn">
        + Add Row
      </button>
    </div>

    <!-- CSV Upload Section -->
    <div class="card mt-3">
      <h3>Or Upload CSV File</h3>
      <p class="text-secondary">
        Upload a CSV file to populate the table above.
        The CSV can include columns for <code>title</code>, <code>bpm</code>, <code>time_signature</code>, and optionally <code>song_id</code>.
        Any additional columns will be ignored.<br>
        <strong>⚠️ Warning: This will overwrite any existing entries in the table.</strong>
      </p>
      <input type="file" id="csvFile" accept=".csv" style="margin-top: 10px;" />
      <div id="csvStatus" class="mt-2 hidden"></div>
    </div>

    <!-- Validation Error Banner -->
    <div id="validationError" class="alert alert-error mt-3 hidden"></div>

    <!-- Submit Button -->
    <div class="mt-3">
      <button class="btn btn-primary" id="submitBtn" style="width: 100%; padding: 15px 40px; font-size: 1.1rem;">
        Confirm and Continue
      </button>
    </div>

    <div id="loadingSpinner" class="hidden">
      <div class="spinner"></div>
      <p class="text-center">Saving songs...</p>
    </div>
  </div>

  <script type="module" src="js/upload-songs.js"></script>
</body>
</html>
